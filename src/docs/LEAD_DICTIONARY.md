# Lead Data Dictionary & Workflow

This document provides a complete explanation of the `Lead` data model, which represents a single help request or "case" within the application.

---

## 1. What is a Lead?

A **Lead** is the central record for a beneficiary's request for assistance. It tracks everything from the initial submission, through verification and public fundraising, to the final disbursement of funds and closure of the case.

---

## 2. Lead Data Model

This table details every field in the Firestore `leads` collection.

| Field | Data Type | Description |
| :--- | :--- | :--- |
| **`id`** | `string` | The unique, custom-generated identifier for the lead (e.g., `USR1_1_16092025`). |
| **`name`** | `string` | The name of the beneficiary associated with the lead. |
| **`beneficiaryId`** | `string` | The user ID of the beneficiary. Links to a document in the `users` collection. |
| **`headline`** | `string` | A short, one-sentence summary of the case, suitable for public display. |
| **`story`** | `string` | A detailed narrative of the beneficiary's situation, often generated by AI for public viewing. |
| **`purpose`** | `LeadPurpose` | The primary reason for the help request (e.g., 'Education', 'Medical'). |
| **`category`** | `string` | A sub-category for the purpose (e.g., 'School Fees', 'Hospital Bill'). |
| **`donationType`** | `DonationType` | The primary type of donation that should be used for this lead (e.g., 'Zakat', 'Sadaqah'). This is often inferred from the purpose. |
| **`acceptableDonationTypes`**| `DonationType[]`| An array listing all types of donations that are permissible for this case. |
| **`helpRequested`** | `number` | The total monetary amount the beneficiary has requested. |
| **`helpGiven`** | `number` | The total amount of funds that have been transferred to the beneficiary for this case. This is the sum of all `FundTransfer` amounts. |
| **`fundingGoal`** | `number` | The fundraising target displayed on public pages, which may differ from `helpRequested`. Defaults to `helpRequested`. |
| **`collectedAmount`** | `number` | A field primarily for historical records, indicating the total amount collected for a past campaign or lead. |
| **`isLoan`** | `boolean` | If `true`, this help request is a repayable loan, not a grant. |
| **`isHistoricalRecord`** | `boolean` | If `true`, this lead is a record of a past, completed case and is not active. |
| **`priority`** | `LeadPriority` | The internal priority level for the case ('Urgent', 'High', 'Medium', 'Low'). |
| **`caseDetails`** | `string` | Internal, admin-only notes and a detailed summary of the case. |
| **`source`** | `string` | Indicates how the lead was created (e.g., 'Manual Entry', 'AI Scan'). |
| **`adminAddedBy`** | `object` | An object containing the `id` and `name` of the administrator who created the lead. |
| **`referredByUserId`** | `string` | The user ID of the person who referred this beneficiary. |
| **`referredByUserName`** | `string` | The name of the person who referred this beneficiary. |
| **`campaignId`** | `string` | The ID of the fundraising campaign this lead is linked to, if any. |
| **`campaignName`** | `string` | The name of the linked campaign. |
| **`donations`** | `LeadDonationAllocation[]` | An array of objects, each representing a donation that has been allocated to this lead. |
| **`fundTransfers`** | `FundTransfer[]` | An array of objects, each representing a financial transfer made to the beneficiary for this lead. |
| **`verifiers`** | `Verifier[]` | An array of objects, each representing an admin who has verified this lead. |
| **`verificationDocumentUrl`**| `string` | The URL to a supporting document (e.g., medical bill, fee receipt) stored in Firebase Storage. |

### Status Fields

These three fields work together to define the lead's current state in the workflow.

| Field | Data Type | Description |
| :--- | :--- | :--- |
| **`caseVerification`** | `LeadVerificationStatus`| Tracks the internal verification state: 'Pending', 'Verified', 'Rejected', etc. This is the first gate a new lead must pass. |
| **`caseAction`** | `LeadAction` | The primary, user-facing action status. It determines what can be done with the lead (e.g., 'Ready For Help', 'Publish', 'Closed'). |
| **`caseStatus`** | `LeadStatus` | **(Deprecated/Legacy)** An older status field. The system is transitioning to primarily use `caseAction` for workflow logic. |

### Date Fields

| Field | Data Type | Description |
| :--- | :--- | :--- |
| **`dateCreated`** | `Date` | The date the lead was first created in the system. Used for sorting. |
| **`caseReportedDate`**| `Date` | The date the beneficiary actually reported their need, which may be different from when it was entered. |
| **`dueDate`** | `Date` | The deadline by which the funds are needed. |
| **`verificationDueDate`**| `Date` | The internal deadline for the admin team to complete verification. |
| **`closedAt`** | `Date` | The timestamp when the lead's `caseAction` was set to 'Closed'. |
| **`verifiedAt`** | `Date` | The timestamp of the most recent verification action. |

### Education-Specific Fields

| Field | Data Type | Description |
| :--- | :--- | :--- |
| **`degree`** | `string` | The degree or class the student is enrolled in (e.g., 'B.E.', 'HSC'). |
| **`year`** | `string` | The academic year (e.g., 'First Year', 'X'). |
| **`semester`** | `string` | The academic semester (e.g., 'III', 'V'). |

### Medical-Specific Fields

| Field | Data Type | Description |
| :--- | :--- | :--- |
| **`diseaseIdentified`**| `string` | The name of the diagnosis or medical condition (e.g., 'Typhoid Fever'). |
| **`diseaseStage`** | `string` | The stage or severity of the condition (e.g., 'Stage II', 'Chronic'). |
| **`diseaseSeriousness`**| `string` | An inferred level of urgency ('High', 'Moderate', 'Low'). |

---

## 3. Lead Workflow Lifecycle

A lead progresses through several stages, primarily managed by its `caseVerification` and `caseAction` statuses.

1.  **Creation (`Pending`):**
    -   A new lead is created by an admin or a beneficiary.
    -   `caseVerification` is **'Pending'**.
    -   `caseAction` is **'Pending'**.
    -   The lead appears on the Admin Dashboard in the "Pending Lead Verifications" section.

2.  **Verification (`Verified` / `Rejected`):**
    -   An admin reviews the lead's details and documents.
    -   If approved, `caseVerification` becomes **'Verified'**. The `caseAction` status is automatically updated to **'Ready For Help'**.
    -   If rejected, `caseVerification` becomes **'Rejected'**, and the lead is removed from active queues.

3.  **Publishing (`Publish`):**
    -   A lead with the `caseAction` of **'Ready For Help'** appears in the "Leads Ready for Publishing" section on the Admin Dashboard.
    -   An admin can click "Publish" on the dashboard or edit the lead and set the `caseAction` to **'Publish'**.
    -   This action makes the lead visible on the `/public-leads` page for public donation.

4.  **Funding (`Partial` / `Complete`):**
    -   As donations are allocated to the lead, its `helpGiven` amount increases.
    -   If `helpGiven` is greater than 0 but less than `helpRequested`, the `caseAction` can be considered **'Partial'**.
    -   Once `helpGiven` meets or exceeds `helpRequested`, the `caseAction` becomes **'Complete'**.

5.  **Closure (`Closed`):**
    -   After funds are fully transferred to the beneficiary, an admin manually sets the `caseAction` to **'Closed'**.
    -   This marks the case as successfully resolved and moves it out of all active queues. It now contributes to the "Cases Closed" metric.
